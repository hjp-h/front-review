<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>闭包</title>
</head>
<body>
    <script>
        //闭包输出1 2 3 4 5
    //    for(var i=1;i<=5;i++){
    //       -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


    //    var test = (function(a){
    //      this.a = a;
    //      return function(b){
    //         return this.a + b;
    //      }  
    //    }(function (a,b) {
    //        return a;
    //    }(11,45)));
    //    console.log(test(7));

    //    for(var i = 1;i<=5;i++) {
    //        setTimeout(((i) => {
    //            return () => {
    //                console.log(i);
    //            }
    //        })(i), i*1000);
    //    }
    
    // for(var i = 1;i<=5;i++) {
    //       (function(i){//注意这个i不是for循环的i,是自己函数内部的i
    //           console.log(i);
    //       })();
    //    }

       
    /* 1.什么是作用域？
        作用域就是存放变量的空间以及这些变量所能作用的范围。分为全局作用域，函数作用域，
        块级作用域，

        2.作用域链？
        不同的作用域之间可以相互嵌套，作用域之间会形成一个引用的关系，这个关系就是作用域链。

        3.闭包？
          1.什么是闭包
          闭包是指有权访问另一个函数作用域中变量的函数

          2.闭包形成的条件
          内部的函数存在外部作用域的引用就会导致闭包。

          3.闭包解决的问题

            闭包是为了解决子函数晚于父函数销毁的问题，我们会在父函数销毁时，
            把子函数引用到的变量打成 Closure 包放到函数的 [[Scopes]] 上，
            让它即使父函数销毁了也随时随地能访问外部环境。

          4.父作用域执行完了，要不要销毁？

          我们知道 JavaScript 引擎会把内存分为函数调用栈、全局作用域和堆，
          其中堆用于放一些动态的对象，调用栈每一个栈帧放一个函数的执行上下文，
          里面有一个 local 变量环境用于放内部声明的一些变量，
          如果是对象，会在堆上分配空间，然后把引用保存在栈帧的 local 环境中。
          全局作用域也是一样，只不过一般用于放静态的一些东西，有时候也叫静态域。

          如果父作用域执行完了，因为子函数还没执行的话没销毁，而一直常驻内存，是非常
          耗性能的，因此需要销毁。

          那销毁了，子函数引用父作用域的变量怎么办？
          -放心，js引擎在解析函数的时候，会帮你把需要引用的变量帮你打包成closure闭包，放在
          [[score]]中。注意：使用eval的时候它无法静态分析出你所需要引用的变量，因此它会把父
          作用域的东西都打包放在[[score]]属性中。

          4 .闭包的缺点
            内存泄露：当父作用域销毁了，而返回的函数会把作用域链过滤出用到的引用形成闭包链放在堆中。
            这就导致了一个隐患： 如果一个很大的对象被函数引用，本来函数调用结束就能销毁，
            但是现在引用却被通过闭包保存到了堆里，而且还一直用不到，那这块堆内存就一直没法使用，
             严重到一定程度就算是内存泄漏了。

    */
    </script>
</body>
</html>
